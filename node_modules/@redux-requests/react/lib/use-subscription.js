"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _react = require("react");

var _reactRedux = require("react-redux");

var _core = require("@redux-requests/core");

var _useDispatchRequest = _interopRequireDefault(require("./use-dispatch-request"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var emptyVariables = [];

var useSubscriptions = function useSubscriptions(_ref) {
  var _ref$variables = _ref.variables,
      variables = _ref$variables === void 0 ? emptyVariables : _ref$variables,
      type = _ref.type,
      requestKey = _ref.requestKey,
      action = _ref.action,
      _ref$active = _ref.active,
      active = _ref$active === void 0 ? true : _ref$active;
  var dispatchRequest = (0, _useDispatchRequest["default"])();
  var store = (0, _reactRedux.useStore)();
  var key = "" + type + (requestKey || '');
  (0, _react.useEffect)(function () {
    if (active) {
      dispatchRequest((action || type).apply(void 0, variables));
    }
  }, [active, action, type].concat(variables));
  (0, _react.useEffect)(function () {
    dispatchRequest((0, _core.addWatcher)(key));
    return function () {
      dispatchRequest((0, _core.removeWatcher)(key));

      if (!store.getState().requests.watchers[key]) {
        dispatchRequest((0, _core.stopSubscriptions)([key]));
      }
    };
  }, [type, requestKey]);
};

var _default = useSubscriptions;
exports["default"] = _default;